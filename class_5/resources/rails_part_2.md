# Intro to Rails (Part 2)

## What you will learn in this course
* Working with the controller
* Routing
* Starting the view layer

## Controller

## Routes

**Intro**: Your routes files describes URL patterns and matches those patterns with incoming HTTP requests to determine which controller should handle the request. Let's find your routes.rb file:
```rb
Rails.application.routes.draw do
  root 'posts#index'

  resources :posts
end
```

**Root Route**: Sets the controller and view that the user will be taken to if the visit your base url (`/`) (eg: http://p-school-blog.herokuapp.com/). Syntax: `root 'posts#index'`

**Resources**: This is a bit of rails magic, but whenever you add a new controller `resource` to your `routes.rb` file (eg: `resources :posts`), it will register URL patterns for all the controller actions: `index` (read – all posts), `show` (read – a single post), `new` (get – a new empty post object), `create` (post – a new post based off of the entered content), `edit` (get – the post object that you want to edit), `update` (patch – persisting the newly edited info to your blog post), `destroy` (delete – deleting post from database).

This can also be achieved manually, but rails generates these patterns for us. We can look at all the routes that your app has generated by typing `rake routes`

**CRUD & Route Resources**: There are 4 main actions a controller can take: Create, Read, Update, and Delete. Most web apps are entirely composed of these four actions. Think of how Facebook works - you create posts (POST), edit them (PATCH/PUT), read other people's posts (GET), and sometimes delete them (DELETE).

HTTP Verb | Path            | Controller#Action | Use                                         |
----------|-----------------|-------------------|---------------------------------------------|
GET       | /posts          |   posts#index     | display a list of all posts                 |
GET       | /posts/new      |   posts#new       | return an HTML form for creating a new post |
POST      | /posts          |   posts#create    | create a new post                           |
GET       | /posts/:id      |   posts#show      | display a specific post                     |
GET       | /posts/:id/edit |   posts#edit      | return an HTML form for editing a post      |
PATCH/PUT | /posts/:id      |   posts#update    | update a specific post                      |
DELETE    | /posts/:id      |   posts#destroy   | delete a specific post                      |

**Controller & View naming conventions**: Once you’ve created a route, if your view is set to the same name as your controller (eg: `posts#show` `show.html.erb`), it will automatically associate the controller and view.

## Controllers

Let's build out our PostsController, which will serve as a simple REST API to interact with Posts in our app.

**REST**: REpresentational State Transfer is an API architecture that is meant to simplify web apis. Here is a brief synopsis:

- Give every “thing” an ID
- Use standard methods
- Communicate statelessly

Using REST you map HTTP verbs to specific controller actions, which can be expected to behave similarly:

GET -> NEW
GET -> SHOW
GET -> INDEX
POST -> CREATE
PATCH -> UPDATE
DELETE -> DESTROY

**ACTIONS**: provide entry points to our applciations. In a REST architure, the actions should be predicatable and simply return a resource.

**Instance Variables**: begin with an ‘@’ sign (eg: @post). Instance variables allow you to share objects from your controller into your associated view. For example, our posts#show controller action, which sets the @post instance variable enables our show.html.erb page to access the data for our blog post.

**Strong Parameters**: Create a safeguard for the parameters that can be assigned by users to an object. Only white-listed parameters can be manipulated by users.

**before_action**: Behavior that has to happen before a controller action is invoked. In the case of our posts controller, on `show`, `update`, `edit` and `destroy`, we want to load the post that is required by the incoming request.

## Views

**html.erb file format**: ERB allows ruby to be included in your html files. You can create an erb file by saving it as `your_file_name.html.erb`

**Putting data in your view with ERB**: Use this syntax to print ruby in your view - `<%= ruby_content %>`.

• Helpful printers include `<%= object.attribute %>`, `<%=link_to “Link Name”, link_path %>`, `<%= image_tag image_url %>`

**Adding ruby logic to your view with ERB**: You can wrap your html content with logic, such as conditionals and iterators with the following syntax:

```html
<% ruby_logic_statement %> <!-- HTML CONTENT -->
<% end %>
```

**Iterators**:
```html
<% Posts.each do |post| %>
  <%= post.title %>
  <%= post.body %>
<% end %>
```

**Conditionals**:
```html
<% if current_user %>
  <%=link_to “Edit profile”, edit_user_path(current_user) %>
<% else %>
  <%=link_to “Create User Account”, new_user_path %>
<% end %>
```

**Forms**: Form are key for creating and updating database objects. Rails offer a number of form helper methods to make creating forms much easier. Below is the general form syntax.
```html
<%= form_for(@post, :html => { :multipart => true } ) do |f| %> <% if @post.errors.any? %>
  <div class="error_messages"> <ul>
    <% @post.errors.full_messages.each do |message| %> <li><%= message %></li>
  <% end %> </ul>
  </div>
<% end %>
  <div class="field">
    <%= f.label :title %>
    <%= f.text_field :title, :required => true %>
  </div>
  <div class="field">
    <%= f.label :body %>
    <%= f.textarea :body, :required => true %>
  </div>
```

In addition to the basic form above other form field types include:

- `<%= text_area_tag(:message, "Hi, nice site", size: "24x6") %> <%= password_field_tag(:password) %>`
- `<%= hidden_field_tag(:parent_id, "5") %>`
- `<%= search_field(:user, :name) %>`
- `<%= telephone_field(:user, :phone) %>`
- `<%= date_field(:user, :born_on) %>`
- `<%= datetime_field(:user, :meeting_time) %>`
- `<%= month_field(:user, :birthday_month) %>`
- `<%= week_field(:user, :birthday_week) %>`
- `<%= url_field(:user, :homepage) %>`
- `<%= file_field(:image) %>`
- `<%= email_field(:user, :address) %>`
- `<%= time_field(:task, :started_at) %>`
- `<%= number_field(:product, :price, in: 1.0..20.0, step: 0.5) %> <%= range_field(:product, :discount, in: 1..100) %>`

**In-Class Exercise**: Improve teh Posts#Index page.

1. Locate `index.html.erb`
2. Create a table to organize our posts.
2. Add some new table headers
3. Add a new table header and new table data cell for `post length` (`length` of post's body)
4. Bonus: do a word count instead of a character count
5. From here we can start our servers (hit `Run` in c9) and navigate the the page.
6. If there are no errors, we should see our page! (If there are some errors, this is a good time to experiment with debugging error messages provided by Rails.

## File Structure
- Each model is a single file in the ‘models’ folder
- Each controller is a single file in the ‘controllers’ folder
- All views associated with actions for a single controller are put into a folder that corresponds to the name of the controller (eg: PostsController!‘posts’) and each view file name should match up with the controller action (eg: posts#show!show.html.erb)

## Add our navbar

```HTML
<header class="ps-navbar">
    <a href="#" class="ps-nav-brand">PS Blog</a>

    <nav class="ps-navbar-nav">
        <li>
          <a href="/">Home</a>
        </li>
        <li>
          <a href="#">Sign Up</a>
        </li>
        <li>
          <a href="#">Sign In</a>
        </li>
    </nav>
</header>
```

## Gems

**Introduction**:

Gems are open source, pre-built functionality that you can integrate into your Rails app to give it additional functionality. One of the benefits of Rails is that it is a huge community with an abundance of high-quality, well-documented, well-maintened gems to help you with almost anything you need to build.

**Gemfile**: Include gems in your app by adding them to your Gemfile, using the syntax: `gem gem-name`.

### Extra Resources:
- https://www.ruby-toolbox.com/
- https://www.codeschool.com/courses/rails-for-zombies-redux (for learning more about routing)
- https://www.codeschool.com/courses/rails-for-zombies-redux (for learning more about views)
- http://guides.rubyonrails.org/routing.html
- http://guides.rubyonrails.org/routing.html#crud-verbs-and-actions
- http://guides.rubyonrails.org/form_helpers.html
- http://guides.rubyonrails.org/form_helpers.html

### Looking forward:

In our next lesson we'll put all of the pieces together.  We will be walking through our applications to connect all of our views, controllers and models for a fully functional (but not styled) blogging app.
